<script>
/**
 * Client-side API bridge â†’ server (Apps Script)
 * Targets uniquely named exports to avoid collisions:
 *   hub_ping, hub_searchClient, hub_searchByFormId, hub_createClient, hub_mergeClient
 */
const API = {
  _handleFailure(err) {
    console.error('[server error]', err);
    const el = document.getElementById('result');
    if (el) {
      el.innerHTML =
        `<div class="card" style="border-color:#ef4444;">
           <h3 style="margin:0 0 .5rem;">Server error</h3>
           <pre style="white-space:pre-wrap;">${(err && err.message) ? err.message : String(err)}</pre>
         </div>`;
    }
  },

  ping(onSuccess, onError) {
    google.script.run
      .withSuccessHandler(onSuccess)
      .withFailureHandler(onError || API._handleFailure)
      .hub_ping();
  },

  searchClient(query, onSuccess, onError) {
    google.script.run
      .withSuccessHandler(onSuccess)
      .withFailureHandler(onError || API._handleFailure)
      .hub_searchClient(query);
  },

  searchByFormId(id, onSuccess, onError) {
    google.script.run
      .withSuccessHandler(onSuccess)
      .withFailureHandler(onError || API._handleFailure)
      .hub_searchByFormId(id);
  },

  createClient(data, onSuccess, onError) {
    google.script.run
      .withSuccessHandler(onSuccess)
      .withFailureHandler(onError || API._handleFailure)
      .hub_createClient(data);
  },

  mergeClient(existing, candidate, onSuccess, onError) {
    google.script.run
      .withSuccessHandler(onSuccess)
      .withFailureHandler(onError || API._handleFailure)
      .hub_mergeClient(existing, candidate);
  }
};
</script>